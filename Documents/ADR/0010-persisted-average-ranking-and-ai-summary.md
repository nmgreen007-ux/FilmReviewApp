# ADR-0010: Persisting Average Ranking and AI Summary

## Status
Accepted

## Context
The Film Review App displays an average ranking and an AI-generated summary of review notes alongside the film details. A decision was needed on whether these values are calculated on every page load or computed once and stored.

## Decision
Both the average ranking and the AI summary are persisted as columns on the `Film` table (`AverageRanking` and `AiSummary`). Both values are recalculated and updated by the `ReviewsService` each time a new review is submitted. All subsequent reads serve the stored values directly.

## Reasons
- The AI summary is generated by calling an external LLM via Azure OpenAI, which consumes tokens on every invocation. Recalculating on every page load would incur unnecessary cost and latency when the underlying review data has not changed
- Both values are only invalidated when a new review is submitted — recalculating at that point and persisting the result means reads are always cheap regardless of how frequently the page loads
- The average ranking could be calculated cheaply via a SQL aggregate on each read, but persisting it alongside the AI summary keeps the approach consistent and avoids two different strategies for the same problem
- Both fields are nullable — no value is stored until the first review is submitted, and the frontend handles this state gracefully

## Alternatives Considered
Calculating both values on every page load was considered and rejected. For the average ranking this would be acceptable, but for the AI summary it would result in an LLM call on every read — wasteful, slow, and costly at any meaningful scale.

## Consequences
- Token consumption is minimised — the LLM is called once per review submission, not once per page load
- Read performance is consistent regardless of the number of reviews or page load frequency
- The `ReviewsService` is responsible for recalculating and persisting both values on every new review submission
- Both fields are nullable and the frontend handles the no-reviews state gracefully
